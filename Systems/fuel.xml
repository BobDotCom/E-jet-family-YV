<PropertyList>
    <filter>
        <type>gain</type>
        <gain>1</gain>
        <input>
            <expression>
                <difference>
                    <property>/consumables/fuel/tank[1]/level-kg</property>
                    <property>/consumables/fuel/tank[0]/level-kg</property>
                </difference>
            </expression>
        </input>
        <output>/systems/fuel/difference</output>
    </filter>
    <flipflop>
        <type>RS</type>
        <name>Fuel Imbalance Low 1</name>
        <S>
            <greater-than>
                <property>/systems/fuel/difference</property>
                <value>360</value>
            </greater-than>
        </S>
        <R>
            <less-than>
                <property>/systems/fuel/difference</property>
                <value>45</value>
            </less-than>
        </R>
        <output>/systems/fuel/imbalance-left-low</output>
    </flipflop>
    <flipflop>
        <type>RS</type>
        <name>Fuel Imbalance Low 2</name>
        <S>
            <less-than>
                <property>/systems/fuel/difference</property>
                <value>-360</value>
            </less-than>
        </S>
        <R>
            <greater-than>
                <property>/systems/fuel/difference</property>
                <value>-45</value>
            </greater-than>
        </R>
        <output>/systems/fuel/imbalance-right-low</output>
    </flipflop>
    <filter>
        <type>gain</type>
        <gain>1</gain>
        <input>
            <condition>
                <property>/systems/fuel/imbalance-left-low</property>
            </condition>
            <value>-1</value>
        </input>
        <input>
            <condition>
                <property>/systems/fuel/imbalance-right-low</property>
            </condition>
            <value>1</value>
        </input>
        <input>
            <value>0</value>
        </input>
        <output>/systems/fuel/imbalance</output>
    </filter>

    <filter>
        <name>Crossfeed Valve</name>
        <type>gain</type>
        <output>/systems/fuel/crossfeed-valve</output>
        <input>
            <condition>
                <and>
                    <equals>
                        <property>/controls/fuel/crossfeed</property>
                        <value>0</value>
                    </equals>
                </and>
            </condition>
            <property>/systems/fuel/imbalance</property>
        </input>
        <input>
            <property>/controls/fuel/crossfeed</property>
        </input>
    </filter>
    
    <filter>
        <name>Left Wing Tank Fuel Pump</name>
        <type>gain</type>
        <input>
            <condition>
                <and>
                    <!-- AC pump -->
                    <less-than>
                        <property>/systems/electrical/outputs/fuel-pump[0]</property>
                        <value>110</value>
                    </less-than>
                    <!-- Ejector pump -->
                    <not>
                        <property>/engines/engine[0]/running</property>
                    </not>
                </and>
            </condition>
            <value>0</value>
        </input>
        <input>
            <value>2</value>
        </input>
        <output>/fdm/jsbsim/propulsion/tank[0]/priority</output>
    </filter>
    <logic>
        <name>Left Wing AC Pump Demand</name>
        <input>
            <and>
                <property>/controls/fuel/tank[0]/boost-pump[0]</property>
                <or>
                    <greater-than>
                        <property>/systems/fuel/crossfeed-valve</property>
                        <value>0</value>
                    </greater-than>
                    <not>
                        <property>/engines/engine[0]/running</property>
                    </not>
                </or>
            </and>
        </input>
        <output>/systems/fuel/fuel-pump[0]/demand</output>
    </logic>
    <logic>
        <name>Left Wing AC Pump Running</name>
        <input>
            <and>
                <property>/systems/electrical/outputs/fuel-pump[0]</property>
                <property>/systems/fuel/fuel-pump[0]/demand</property>
            </and>
        </input>
        <output>/systems/fuel/fuel-pump[0]/running</output>
    </logic>
    <filter>
        <name>Right Wing Tank Fuel Pump</name>
        <type>gain</type>
        <input>
            <condition>
                <and>
                    <!-- AC pump -->
                    <less-than>
                        <property>/systems/electrical/outputs/fuel-pump[1]</property>
                        <value>110</value>
                    </less-than>
                    <!-- DC pump -->
                    <less-than>
                        <property>/systems/electrical/outputs/fuel-pump[3]</property>
                        <value>18</value>
                    </less-than>
                    <!-- Ejector pump -->
                    <not>
                        <property>/engines/engine[1]/running</property>
                    </not>
                </and>
            </condition>
            <value>0</value>
        </input>
        <input>
            <value>2</value>
        </input>
        <output>/fdm/jsbsim/propulsion/tank[1]/priority</output>
    </filter>
    <logic>
        <name>Right Wing AC Pump Demand</name>
        <input>
            <and>
                <property>/controls/fuel/tank[1]/boost-pump[0]</property>
                <or>
                    <less-than>
                        <property>/systems/fuel/crossfeed-valve</property>
                        <value>0</value>
                    </less-than>
                    <not>
                        <property>/engines/engine[1]/running</property>
                    </not>
                </or>
            </and>
        </input>
        <output>/systems/fuel/fuel-pump[1]/demand</output>
    </logic>
    <logic>
        <name>Right Wing AC Pump Running</name>
        <input>
            <and>
                <property>/systems/electrical/outputs/fuel-pump[1]</property>
                <property>/systems/fuel/fuel-pump[1]/demand</property>
            </and>
        </input>
        <output>/systems/fuel/fuel-pump[1]/running</output>
    </logic>
    <logic>
        <name>Right Wing DC Pump Demand</name>
        <input>
            <and>
                <property>/controls/fuel/tank[1]/boost-pump[1]</property>
                <not>
                    <!-- AC pump 2 is running, DC pump not needed -->
                    <property>/systems/fuel/fuel-pump[1]/running</property>
                </not>
                <not>
                    <!-- EJ pump 2 is running, DC pump not needed -->
                    <property>/engines/engine[1]/running</property>
                </not>
                <not>
                    <!-- Crossfeeding from left side, DC pump not needed -->
                    <and>
                        <equals>
                            <property>/systems/fuel/crossfeed-valve</property>
                            <value>1</value>
                        </equals>
                        <or>
                            <property>/engines/engine[0]/running</property>
                            <property>/systems/fuel/fuel-pump[0]/running</property>
                        </or>
                    </and>
                </not>
            </and>
        </input>
        <output>/systems/fuel/fuel-pump[3]/demand</output>
    </logic>
    <logic>
        <name>Right Wing DC Pump Running</name>
        <input>
            <and>
                <property>/systems/electrical/outputs/fuel-pump[3]</property>
                <property>/systems/fuel/fuel-pump[3]/demand</property>
            </and>
        </input>
        <output>/systems/fuel/fuel-pump[3]/running</output>
    </logic>
    <filter>
        <name>Auxiliary Tank Fuel Pump (Lineage 1000)</name>
        <type>gain</type>
        <input>
            <condition>
                <!-- AC pump -->
                <less-than>
                    <property>/systems/electrical/outputs/fuel-pump[2]</property>
                    <value>110</value>
                </less-than>
                <!-- Ejector pump 1 -->
                <not>
                    <property>/engines/engine[0]/running</property>
                </not>
                <!-- Ejector pump 2 -->
                <not>
                    <property>/engines/engine[1]/running</property>
                </not>
            </condition>
            <value>0</value>
        </input>
        <input>
            <value>1</value>
        </input>
        <output>/fdm/jsbsim/propulsion/tank[2]/priority</output>
    </filter>
    <logic>
        <name>Auxiliary Tank AC Pump Demand</name>
        <input>
            <and>
                <property>/controls/fuel/tank[2]/boost-pump[0]</property>
                <not>
                    <property>/engines/engine[0]/running</property>
                </not>
                <not>
                    <property>/engines/engine[1]/running</property>
                </not>
            </and>
        </input>
        <output>/systems/fuel/fuel-pump[2]/demand</output>
    </logic>
    <logic>
        <name>Auxiliary Tank AC Pump Running</name>
        <input>
            <and>
                <property>/systems/electrical/outputs/fuel-pump[2]</property>
                <property>/systems/fuel/fuel-pump[2]/demand</property>
            </and>
        </input>
        <output>/systems/fuel/fuel-pump[2]/running</output>
    </logic>

    <filter>
        <name>Crossfeed Flow</name>
        <type>gain</type>
        <gain>1</gain>
        <output>/systems/fuel/crossfeed-flow-pps</output>
        <input>
            <condition>
                <and>
                    <!-- crossfeed valve open in L <- R direction -->
                    <equals>
                        <property>/systems/fuel/crossfeed-valve</property>
                        <value>-1</value>
                    </equals>
                    <!-- Right wing tank available -->
                    <property>/fdm/jsbsim/propulsion/tank[1]/priority</property>
                    <!-- Right wing tank not empty -->
                    <greater-than>
                        <property>/fdm/jsbsim/propulsion/tank[1]/contents-lbs</property>
                        <value>0</value>
                    </greater-than>
                </and>
            </condition>
            <expression>
                <difference>
                    <property>/fdm/jsbsim/propulsion/engine[1]/fuel-flow-rate-pps</property>
                    <value>4</value>
                </difference>
            </expression>
        </input>
        <input>
            <condition>
                <and>
                    <!-- crossfeed valve open in R <- L direction -->
                    <equals>
                        <property>/systems/fuel/crossfeed-valve</property>
                        <value>1</value>
                    </equals>
                    <!-- Left wing tank available -->
                    <property>/fdm/jsbsim/propulsion/tank[0]/priority</property>
                    <!-- Left wing tank not empty -->
                    <greater-than>
                        <property>/fdm/jsbsim/propulsion/tank[0]/contents-lbs</property>
                        <value>0</value>
                    </greater-than>
                </and>
            </condition>
            <expression>
                <difference>
                    <value>4</value>
                    <property>/fdm/jsbsim/propulsion/engine[1]/fuel-flow-rate-pps</property>
                </difference>
            </expression>
        </input>
        <input><value>0</value></input>
    </filter>

    <filter>
        <name>Crossfeed flow to right tank</name>
        <type>gain</type>
        <gain>3600</gain>
        <input>
            <property>/systems/fuel/crossfeed-flow-pps</property>
        </input>
        <output>/systems/fuel/external-flow[1]/crossfeed</output>
    </filter>
    <filter>
        <name>Crossfeed flow to left tank</name>
        <type>gain</type>
        <gain>-3600</gain>
        <input>
            <property>/systems/fuel/crossfeed-flow-pps</property>
        </input>
        <output>/systems/fuel/external-flow[0]/crossfeed</output>
    </filter>

    <filter>
        <name>Tank 0 external flow</name>
        <type>gain</type>
        <output>/fdm/jsbsim/propulsion/tank[0]/external-flow-rate-pps</output>
        <input>
            <expression>
                <div>
                    <sum>
                        <property>/systems/fuel/external-flow[0]/apu</property>
                        <property>/systems/fuel/external-flow[0]/crossfeed</property>
                    </sum>
                    <value>3600</value>
                </div>
            </expression>
        </input>
    </filter>
    <filter>
        <name>Tank 1 external flow</name>
        <type>gain</type>
        <output>/fdm/jsbsim/propulsion/tank[1]/external-flow-rate-pps</output>
        <input>
            <expression>
                <div>
                    <sum>
                        <property>/systems/fuel/external-flow[1]/apu</property>
                        <property>/systems/fuel/external-flow[1]/crossfeed</property>
                    </sum>
                    <value>3600</value>
                </div>
            </expression>
        </input>
    </filter>
    <filter>
        <name>Tank 2 external flow</name>
        <type>gain</type>
        <output>/fdm/jsbsim/propulsion/tank[2]/external-flow-rate-pps</output>
        <input>
            <expression>
                <div>
                    <sum>
                        <property>/systems/fuel/external-flow[2]/apu</property>
                    </sum>
                    <value>3600</value>
                </div>
            </expression>
        </input>
    </filter>

    <logic>
        <name>Fuel Line Pressure Engine 1</name>
        <output>/systems/fuel/pressure/engine[0]</output>
        <input>
            <and>
                <not><property>/engines/engine[0]/cutoff</property></not>
                <property>/systems/fuel/pressure/tank[0]</property>
            </and>
        </input>
    </logic>
    <logic>
        <name>Fuel Line Pressure Engine 2</name>
        <output>/systems/fuel/pressure/engine[1]</output>
        <input>
            <and>
                <not><property>/engines/engine[1]/cutoff</property></not>
                <property>/systems/fuel/pressure/tank[1]</property>
            </and>
        </input>
    </logic>
    <logic>
        <name>Fuel Line Pressure APU</name>
        <output>/systems/fuel/pressure/apu</output>
        <input>
            <and>
                <not><property>/engines/apu/cutoff</property></not>
                <property>/systems/fuel/pressure/tank[1]</property>
            </and>
        </input>
    </logic>
    <logic>
        <name>Fuel Line Pressure Left Tank</name>
        <output>/systems/fuel/pressure/tank[0]</output>
        <input>
            <or>
                <property>/systems/fuel/pressure/pump[0]</property>
                <property>/systems/fuel/pressure/pump[2]</property>
                <property>/systems/fuel/pressure/pump[4]</property>
                <and>
                    <equals>
                        <property>/systems/fuel/crossfeed-valve</property>
                        <value>-1</value>
                    </equals>
                    <property>/systems/fuel/pressure/tank[1]</property>
                </and>
            </or>
        </input>
    </logic>
    <logic>
        <name>Fuel Line Pressure Right Tank</name>
        <output>/systems/fuel/pressure/tank[1]</output>
        <input>
            <or>
                <property>/systems/fuel/pressure/pump[1]</property>
                <property>/systems/fuel/pressure/pump[2]</property>
                <property>/systems/fuel/pressure/pump[3]</property>
                <property>/systems/fuel/pressure/pump[5]</property>
                <and>
                    <equals>
                        <property>/systems/fuel/crossfeed-valve</property>
                        <value>1</value>
                    </equals>
                    <property>/systems/fuel/pressure/tank[0]</property>
                </and>
            </or>
        </input>
    </logic>

    <logic>
        <name>Fuel Line Pressure AC pump 1</name>
        <output>/systems/fuel/pressure/pump[0]</output>
        <input>
            <and>
                <property>/systems/fuel/fuel-pump[0]/running</property>
                <greater-than>
                    <property>/fdm/jsbsim/propulsion/tank[0]/contents-lbs</property>
                    <value>0</value>
                </greater-than>
            </and>
        </input>
    </logic>
    <logic>
        <name>Fuel Line Pressure AC pump 2</name>
        <output>/systems/fuel/pressure/pump[1]</output>
        <input>
            <and>
                <property>/systems/fuel/fuel-pump[1]/running</property>
                <greater-than>
                    <property>/fdm/jsbsim/propulsion/tank[1]/contents-lbs</property>
                    <value>0</value>
                </greater-than>
            </and>
        </input>
    </logic>
    <logic>
        <name>Fuel Line Pressure AC pump 3</name>
        <output>/systems/fuel/pressure/pump[2]</output>
        <input>
            <and>
                <property>/systems/fuel/fuel-pump[2]/running</property>
                <greater-than>
                    <property>/fdm/jsbsim/propulsion/tank[2]/contents-lbs</property>
                    <value>0</value>
                </greater-than>
            </and>
        </input>
    </logic>
    <logic>
        <name>Fuel Line Pressure DC pump</name>
        <output>/systems/fuel/pressure/pump[3]</output>
        <input>
            <and>
                <property>/systems/fuel/fuel-pump[3]/running</property>
                <greater-than>
                    <property>/fdm/jsbsim/propulsion/tank[1]/contents-lbs</property>
                    <value>0</value>
                </greater-than>
            </and>
        </input>
    </logic>
    <logic>
        <name>Fuel Line Pressure Ejector pump 1</name>
        <output>/systems/fuel/pressure/pump[4]</output>
        <input>
            <and>
                <property>/engines/engine[0]/running</property>
                <greater-than>
                    <property>/fdm/jsbsim/propulsion/tank[0]/contents-lbs</property>
                    <value>0</value>
                </greater-than>
            </and>
        </input>
    </logic>
    <logic>
        <name>Fuel Line Pressure Ejector pump 2</name>
        <output>/systems/fuel/pressure/pump[5]</output>
        <input>
            <and>
                <property>/engines/engine[1]/running</property>
                <greater-than>
                    <property>/fdm/jsbsim/propulsion/tank[1]/contents-lbs</property>
                    <value>0</value>
                </greater-than>
            </and>
        </input>
    </logic>

</PropertyList>
