<?xml version="1.0" encoding="utf-8"?>

<PropertyList>
    <filter>
        <type>gain</type>
        <gain>1</gain>
        <input>
            <expression>
                <product>
                    <max>
                        <table>
                            <property>engines/engine[0]/n1</property>
                            <entry>
                                <ind>0</ind><dep>0</dep>
                            </entry>
                            <entry>
                                <ind>10</ind><dep>0</dep>
                            </entry>
                            <entry>
                                <ind>50</ind><dep>1</dep>
                            </entry>
                            <entry>
                                <ind>100</ind><dep>1</dep>
                            </entry>
                        </table>
                        <table>
                            <property>engines/engine[0]/n2</property>
                            <entry>
                                <ind>0</ind><dep>0</dep>
                            </entry>
                            <entry>
                                <ind>10</ind><dep>0</dep>
                            </entry>
                            <entry>
                                <ind>50</ind><dep>1</dep>
                            </entry>
                            <entry>
                                <ind>100</ind><dep>1</dep>
                            </entry>
                        </table>
                    </max>
                </product>
            </expression>
        </input>
        <output>systems/pneumatic/sources/engine[0]</output>
    </filter>
    <logic>
        <input>
            <and>
                <property>controls/pneumatic/engine-bleed[0]</property>
                <greater-than>
                    <property>systems/pneumatic/sources/engine[0]</property>
                    <value>0.8</value>
                </greater-than>
            </and>
        </input>
        <output>systems/pneumatic/valves/engine-bleed[0]</output>
    </logic>
    
    <filter>
        <type>gain</type>
        <gain>1</gain>
        <input>
            <expression>
                <product>
                    <max>
                        <table>
                            <property>engines/engine[1]/n1</property>
                            <entry>
                                <ind>0</ind><dep>0</dep>
                            </entry>
                            <entry>
                                <ind>10</ind><dep>0</dep>
                            </entry>
                            <entry>
                                <ind>50</ind><dep>1</dep>
                            </entry>
                            <entry>
                                <ind>100</ind><dep>1</dep>
                            </entry>
                        </table>
                        <table>
                            <property>engines/engine[1]/n2</property>
                            <entry>
                                <ind>0</ind><dep>0</dep>
                            </entry>
                            <entry>
                                <ind>10</ind><dep>0</dep>
                            </entry>
                            <entry>
                                <ind>50</ind><dep>1</dep>
                            </entry>
                            <entry>
                                <ind>100</ind><dep>1</dep>
                            </entry>
                        </table>
                    </max>
                </product>
            </expression>
        </input>
        <output>systems/pneumatic/sources/engine[1]</output>
    </filter>
    <logic>
        <input>
            <and>
                <property>controls/pneumatic/engine-bleed[1]</property>
                <greater-than>
                    <property>systems/pneumatic/sources/engine[1]</property>
                    <value>0.8</value>
                </greater-than>
            </and>
        </input>
        <output>systems/pneumatic/valves/engine-bleed[1]</output>
    </logic>
    
    <filter>
        <type>gain</type>
        <gain>1</gain>
        <input>
            <expression>
                <product>
                    <table>
                        <property>/engines/apu/rpm</property>
                        <entry>
                            <ind>0</ind><dep>0</dep>
                        </entry>
                        <entry>
                            <ind>85</ind><dep>0</dep>
                        </entry>
                        <entry>
                            <ind>95</ind><dep>1</dep>
                        </entry>
                        <entry>
                            <ind>100</ind><dep>1</dep>
                        </entry>
                    </table>
                </product>
            </expression>
        </input>
        <output>systems/pneumatic/sources/apu</output>
    </filter>
    
    <logic>
        <input>
            <and>
                <property>controls/pneumatic/apu-bleed</property>
                <greater-than>
                    <property>systems/pneumatic/sources/apu</property>
                    <value>0.8</value>
                </greater-than>
                <less-than>
                    <property>systems/pneumatic/sources/engine[0]</property>
                    <value>0.8</value>
                </less-than>
                <not>
                    <property>controls/anti-ice/engine[0]/inlet-heat</property>
                    <property>controls/anti-ice/engine[1]/inlet-heat</property>
                    <property>controls/anti-ice/wing-heat</property>
                </not>
            </and>
        </input>
        <output>systems/pneumatic/valves/apu-bleed</output>
    </logic>
    
    <logic>
        <input>
            <and>
                <property>controls/pneumatic/xbleed</property>
                <or>
                    <!-- no pressure on left side -->
                    <and>
                        <less-than>
                            <property>systems/pneumatic/sources/engine[0]</property>
                            <value>0.8</value>
                        </less-than>
                        <less-than>
                            <property>systems/pneumatic/sources/apu</property>
                            <value>0.8</value>
                        </less-than>
                        <or>
                            <greater-than>
                                <property>systems/pneumatic/sources/engine[1]</property>
                                <value>0.8</value>
                            </greater-than>
                            <greater-than>
                                <property>systems/pneumatic/sources/ground-cart</property>
                                <value>0.8</value>
                            </greater-than>
                        </or>
                    </and>
                    <!-- no pressure on right side -->
                    <and>
                        <or>
                            <greater-than>
                                <property>systems/pneumatic/sources/engine[0]</property>
                                <value>0.8</value>
                            </greater-than>
                            <greater-than>
                                <property>systems/pneumatic/sources/apu</property>
                                <value>0.8</value>
                            </greater-than>
                        </or>
                        <less-than>
                            <property>systems/pneumatic/sources/engine[1]</property>
                            <value>0.8</value>
                        </less-than>
                        <less-than>
                            <property>systems/pneumatic/sources/ground-cart</property>
                            <value>0.8</value>
                        </less-than>
                    </and>
                    <!-- engine #2 start in air -->
                    <and>
                        <not>
                            <property>gear/gear[0]/wow</property>
                        </not>
                        <property>engines/engine[1]/starter</property>
                    </and>
                    <!-- APU bleed OFF and engine #1 start in air -->
                    <and>
                        <not>
                            <property>gear/gear[0]/wow</property>
                        </not>
                        <property>engines/engine[0]/starter</property>
                        <less-than>
                            <property>systems/pneumatic/sources/apu</property>
                            <value>0.8</value>
                        </less-than>
                    </and>
                </or>
            </and>
        </input>
        <output>systems/pneumatic/valves/xbleed</output>
    </logic>
    
    <filter>
        <type>gain</type>
        <gain>1</gain>
        <input>
            <property>/controls/electric/external-power-connected</property>
        </input>
        <output>systems/pneumatic/sources/ground-cart</output>
    </filter>
    
    <filter>
        <type>gain</type>
        <gain>1</gain>
        <input>
            <expression>
                <max>
                    <product>
                        <property>systems/pneumatic/sources/apu</property>
                        <property>systems/pneumatic/valves/apu-bleed</property>
                    </product>
                    <product>
                        <property>systems/pneumatic/sources/engine[0]</property>
                        <property>systems/pneumatic/valves/engine-bleed[0]</property>
                    </product>
                    <product>
                        <property>systems/pneumatic/valves/xbleed</property>
                        <max>
                            <property>systems/pneumatic/sources/ground-cart</property>
                            <product>
                                <property>systems/pneumatic/sources/engine[1]</property>
                                <property>systems/pneumatic/valves/engine-bleed[1]</property>
                            </product>
                        </max>
                    </product>
                </max>
            </expression>
        </input>
        <output>systems/pneumatic/buses/bus[0]</output>
    </filter>
    <filter>
        <type>gain</type>
        <gain>1</gain>
        <input>
            <expression>
                <max>
                    <product>
                        <property>systems/pneumatic/valves/xbleed</property>
                        <max>
                            <product>
                                <property>systems/pneumatic/sources/apu</property>
                                <property>systems/pneumatic/valves/apu-bleed</property>
                            </product>
                            <product>
                                <property>systems/pneumatic/sources/engine[0]</property>
                                <property>systems/pneumatic/valves/engine-bleed[0]</property>
                            </product>
                        </max>
                    </product>
                    <property>systems/pneumatic/sources/ground-cart</property>
                    <product>
                        <property>systems/pneumatic/sources/engine[1]</property>
                        <property>systems/pneumatic/valves/engine-bleed[1]</property>
                    </product>
                </max>
            </expression>
        </input>
        <output>systems/pneumatic/buses/bus[1]</output>
    </filter>
</PropertyList>
